name: Build curriculum pdf from markdown file and publish it
on:
  push:
    paths-ignore:
      - README.md
  workflow_dispatch:

jobs:
  build-md:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
      - name: Install missing fonts
        run: |
          wget -O Source_Sans_Pro.zip "https://fonts.google.com/download?family=Source%20Sans%20Pro"
          unzip -d source_sans_pro/ Source_Sans_Pro.zip
          mv source_sans_pro /usr/share/fonts/
          fc-cache -fv
      - name: Setup Typst
        uses: typst-community/setup-typst@v3
      - name: Compile the resume
        run: typst compile resume.typ resume.pdf
      - name: Get current time
        id: current-time
        uses: josStorer/get-current-time@v2
        with:
          format: YYYY-MMM-DD
      - name: Release resume
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG: ${{ steps.current-time.outputs.formattedTime }}
        run: |
          hub release create -m "Resume" $TAG
          gh release upload $TAG resume.pdf
